package tn.esprit.examen.nomPrenomClasseExamen.service;

import jakarta.mail.MessagingException;
import jakarta.mail.internet.MimeMessage;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Service;

import java.awt.*;
import java.io.File;

@Service
public class MailService {

     @Autowired
     JavaMailSender mailSender;

    public void sendRefundUpdate(String toEmail, String subject, String message) {
        SimpleMailMessage mailMessage = new SimpleMailMessage();
        mailMessage.setFrom("doorstep@tgtv.tn");
        mailMessage.setTo(toEmail);
        mailMessage.setSubject(subject);
        mailMessage.setText(message);
        mailSender.send(mailMessage);
    }


    public void sendHtmlEmail(String toEmail, String subject, String bodyText, String buttonText, String buttonLink) {
        try {
            MimeMessage message = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");

            String htmlContent = "<div style='font-family: Arial, sans-serif; padding: 20px;'>"
                    + "<div style='margin-bottom: 20px; text-align: center;'>"
                    + "<svg version='1.0' xmlns='http://www.w3.org/2000/svg' "
                    + "width='150px' height='55px' viewBox='0 0 300.000000 112.000000' preserveAspectRatio='xMidYMid meet'>"
                    + "<g transform='translate(0.000000,112.000000) scale(0.100000,-0.100000)' fill='#f89434' stroke='none'>"
                    + "<path d='M2137 1098 c-8 -30 2 -70 17 -65 14 5 14 79 0 84 -6 2 -14 -6 -17 -19z'/>"
                    + "<path d='M1316 1063 c-3 -3 -6 -24 -6 -45 0 -27 4 -38 15 -38 11 0 15 11 15 39 0 38 -10 57 -24 44z'/>"
                    + "<path d='M1255 1041 c-8 -27 3 -63 18 -58 7 2 12 19 12 37 0 38 -20 52 -30 21z'/>"
                    + "</g></svg>"
                    + "</div>"
                    + "<h2 style='color: #FF6600; text-align: center;'>" + subject + "</h2>"
                    + "<p style='color: #333333; font-size: 16px; text-align: center;'>" + bodyText + "</p>"
                    + "<div style='text-align: center; margin-top: 20px;'>"
                    + "<a href='" + buttonLink + "' "
                    + "style='display: inline-block; padding: 12px 24px; color: white; "
                    + "background-color: #FF6600; text-decoration: none; border-radius: 5px; "
                    + "font-size: 16px;'>"
                    + buttonText + "</a>"
                    + "</div>"
                    + "</div>"
                    +"<div style='margin-top: 30px;'>"
                    +" <svg version='1.0' xmlns='http://www.w3.org/2000/svg'  width='300.000000pt' height='112.000000pt' viewBox='0 0 300.000000 112.000000'  preserveAspectRatio='xMidYMid meet'>  <g transform='translate(0.000000,112.000000) scale(0.100000,-0.100000)' fill='#f89434' stroke='none'> <path d='M2137 1098 c-8 -30 2 -70 17 -65 14 5 14 79 0 84 -6 2 -14 -6 -17 -19z'/> <path d='M1316 1063 c-3 -3 -6 -24 -6 -45 0 -27 4 -38 15 -38 11 0 15 11 15 39 0 38 -10 57 -24 44z'/> <path d='M1255 1041 c-8 -27 3 -63 18 -58 7 2 12 19 12 37 0 38 -20 52 -30 21z'/> <path d='M312 773 c-39 -120 -103 -309 -141 -421 -38 -112 -71 -213 -73 -225 -3 -20 -8 -22 -50 -19 -39 3 -48 1 -48 -12 0 -19 59 -22 91 -5 27 14 70 114 73 168 2 25 9 49 18 55 8 6 18 28 22 49 4 20 11 37 16 37 6 0 10 9 10 19 0 11 4 22 9 25 5 3 7 15 4 27 -3 12 -2 24 3 28 12 8 44 103 44 130 0 13 4 19 11 16 6 -4 10 -1 8 6 -1 8 -1 25 0 39 1 20 3 22 11 10 7 -12 10 -8 10 15 0 17 6 42 14 57 8 15 12 37 9 50 -3 17 -2 19 5 9 7 -10 12 0 17 38 7 51 21 74 30 49 2 -7 6 -152 9 -323 4 -329 5 -337 18 -329 4 3 8 167 8 365 l0 359 -28 0 c-27 0 -29 -4 -100 -217z'/> <path d='M687 907 c-33 -95 -69 -197 -125 -352 -47 -130 -70 -199 -81 -240 -5 -16 -12 -39 -17 -49 -5 -14 -4 -17 5 -12 9 6 11 1 8 -20 -5 -34 -33 -117 -53 -159 l-14 -30 -205 3 c-180 2 -205 1 -205 -13 0 -14 26 -15 220 -13 l221 3 25 70 c13 39 40 115 59 170 18 55 70 206 115 335 63 182 79 240 71 256 -5 12 -6 36 -1 55 4 19 8 30 9 26 1 -5 8 -1 17 7 25 26 31 11 21 -51 -6 -32 -12 -239 -14 -461 l-3 -402 1115 0 1115 0 0 29 c0 16 3 36 6 45 6 15 -94 16 -1089 16 l-1095 0 1 435 2 435 -40 0 -40 0 -28 -83z m1191 -815 c573 1 1044 -1 1047 -3 2 -3 0 -10 -4 -17 -6 -10 -236 -12 -1071 -12 -585 0 -1066 3 -1069 6 -3 3 1 9 9 14 13 9 13 10 0 10 -13 0 -13 2 -1 9 8 6 22 6 31 1 8 -4 484 -8 1058 -8z'/> <path d='M1267 932 c-21 -23 -37 -67 -37 -102 0 -41 29 -109 51 -120 27 -15 362 -13 377 2 9 9 15 9 24 0 19 -19 202 -16 218 3 7 8 15 53 18 100 4 75 3 85 -11 79 -12 -4 -17 -22 -19 -62 l-3 -57 -94 -3 c-109 -3 -114 0 -105 71 5 43 4 47 -15 47 -19 0 -21 -6 -21 -60 l0 -60 -155 0 -155 0 0 90 0 90 -28 0 c-16 0 -36 -8 -45 -18z m51 -102 c0 -43 -3 -50 -19 -50 -28 0 -45 43 -31 75 7 14 20 25 31 25 16 0 19 -7 19 -50z'/> <path d='M2074 903 c-6 -24 2 -60 30 -123 5 -13 -4 -14 -56 -12 l-63 3 3 45 c3 37 1 44 -14 44 -17 0 -19 -9 -19 -87 0 -83 -1 -88 -22 -91 -19 -3 -21 -8 -16 -35 12 -65 37 -61 54 9 l11 44 229 0 229 0 9 -23 c5 -13 16 -29 26 -37 14 -12 19 -10 38 9 30 30 32 148 3 180 -28 31 -45 26 -64 -19 l-17 -40 -122 0 c-68 0 -123 2 -123 5 0 2 9 22 21 44 12 24 19 53 17 73 l-3 33 -72 3 c-72 3 -72 3 -79 -25z m114 -32 c-2 -3 -10 -23 -18 -43 -8 -21 -17 -38 -20 -38 -3 0 -12 17 -20 38 -8 20 -16 40 -18 43 -1 4 16 6 38 6 22 0 39 -2 38 -6z m318 -105 c8 -35 1 -60 -17 -64 -20 -4 -29 34 -18 66 11 29 27 28 35 -2z m-351 4 c-5 -8 22 -15 47 -11 4 0 4 -7 1 -16 -4 -9 -8 -12 -10 -6 -3 8 -14 8 -38 0 -19 -6 -37 -8 -40 -5 -8 8 6 39 15 33 5 -3 11 -1 15 5 3 5 8 10 11 10 3 0 2 -4 -1 -10z'/> <path d='M1630 630 c0 -29 4 -40 13 -37 6 2 12 19 12 37 0 18 -6 35 -12 38 -9 2 -13 -9 -13 -38z'/> <path d='M1680 630 c0 -43 23 -57 33 -20 7 28 -3 60 -19 60 -10 0 -14 -13 -14 -40z'/> <path d='M1862 633 c4 -43 23 -55 32 -19 8 31 -2 56 -21 56 -10 0 -13 -10 -11 -37z'/> <path d='M1241 403 c-15 -170 -16 -163 15 -163 23 0 25 3 23 38 -1 20 -1 57 0 82 l3 45 8 -35 c5 -19 12 -56 15 -83 10 -73 32 -62 40 21 10 101 20 107 23 15 3 -79 4 -83 26 -83 21 0 23 4 20 48 -2 26 -6 91 -10 145 -6 95 -6 97 -30 97 -14 0 -27 -6 -29 -12 -4 -11 -12 -91 -14 -136 -1 -7 -5 -10 -11 -7 -5 3 -10 33 -10 65 0 73 -6 90 -35 90 -21 0 -22 -6 -34 -127z'/> <path d='M1475 518 c-2 -7 -11 -62 -20 -122 -8 -60 -18 -119 -21 -132 -5 -20 -2 -24 19 -24 16 0 26 7 30 20 7 26 37 26 44 0 4 -13 14 -20 30 -20 22 0 25 3 20 28 -3 15 -13 74 -23 132 -21 135 -19 130 -49 130 -14 0 -28 -6 -30 -12z m40 -136 c3 -37 0 -52 -11 -56 -11 -4 -14 4 -14 38 0 45 9 81 17 72 3 -2 6 -27 8 -54z'/> <path d='M1621 501 c-28 -38 -37 -142 -18 -196 18 -52 57 -81 86 -66 29 16 43 46 50 113 l7 58 -38 0 c-37 0 -38 -1 -38 -35 0 -19 5 -35 10 -35 6 0 10 -7 10 -15 0 -18 -21 -20 -38 -3 -16 16 -15 90 2 113 11 16 17 17 29 7 12 -10 19 -9 36 5 l21 18 -20 33 c-27 43 -70 45 -99 3z'/> <path d='M1768 385 c3 -142 4 -145 25 -145 20 0 22 5 22 52 0 40 4 53 15 53 11 0 16 -14 18 -52 3 -49 5 -53 28 -53 l24 0 0 145 0 145 -25 0 c-23 0 -25 -3 -25 -50 0 -44 -2 -50 -21 -50 -19 0 -21 5 -17 50 3 48 2 50 -22 50 l-25 0 3 -145z m102 4 c0 -14 -5 -19 -17 -17 -23 4 -28 25 -6 31 10 3 19 5 21 6 1 0 2 -8 2 -20z m-50 -5 c0 -3 -7 -12 -15 -20 -12 -13 -15 -13 -15 -1 0 7 3 17 7 20 8 8 23 9 23 1z'/> <path d='M1922 385 l-2 -145 25 0 c23 0 25 3 26 53 0 42 2 48 10 29 5 -13 11 -35 13 -49 6 -32 10 -35 34 -31 20 3 20 4 2 60 -16 51 -16 59 -3 70 12 10 14 26 10 72 -6 69 -22 86 -76 86 l-36 0 -3 -145z m56 78 c-11 -15 -11 -16 5 -10 14 5 17 1 17 -23 0 -40 -26 -40 -32 0 -3 17 -1 33 4 36 5 3 6 15 3 27 -5 20 -5 20 5 4 9 -14 8 -22 -2 -34z'/> <path d='M2062 385 l2 -145 48 0 48 0 0 35 c0 30 -3 35 -24 35 -15 0 -26 7 -29 20 -4 16 0 20 22 20 25 0 27 3 23 36 -4 29 -8 35 -23 31 -14 -4 -19 0 -19 14 0 14 7 19 25 19 23 0 25 4 25 40 l0 40 -49 0 -50 0 1 -145z'/> <path d='M2188 385 l3 -145 44 0 c55 0 70 21 61 89 -6 48 -6 58 -4 128 2 55 -14 73 -66 73 l-41 0 3 -145z m72 48 c0 -14 -19 -28 -27 -20 -3 3 -6 22 -7 42 l-1 35 17 -22 c10 -13 18 -28 18 -35z m-2 -100 c-4 -37 -25 -40 -30 -3 -4 24 -1 30 14 30 15 0 19 -6 16 -27z'/> <path d='M2328 385 c3 -136 4 -145 23 -145 18 0 19 8 19 123 0 67 3 132 6 145 6 19 3 22 -22 22 l-29 0 3 -145z'/> <path d='M2440 527 c0 -3 -22 -131 -45 -259 -4 -24 -1 -28 19 -28 14 0 26 7 28 18 7 25 48 26 48 1 0 -14 7 -19 25 -19 29 0 29 -15 0 155 -24 138 -22 135 -50 135 -14 0 -25 -1 -25 -3z m39 -169 c1 -16 -2 -27 -6 -27 -22 4 -25 -3 -7 -17 17 -14 17 -15 1 -10 -10 3 -23 6 -29 6 -7 0 -7 5 1 14 6 7 14 42 18 77 7 64 7 64 14 24 5 -22 8 -52 8 -67z'/> <path d='M860 170 c0 -12 7 -20 16 -20 13 0 14 3 5 13 -6 8 -8 17 -4 20 3 4 1 7 -5 7 -7 0 -12 -9 -12 -20z'/> <path d='M904 175 c-3 -8 -3 -19 1 -25 7 -12 25 -4 25 11 0 6 -4 7 -10 4 -5 -3 -10 -2 -10 4 0 5 6 12 13 14 9 4 9 6 -1 6 -7 1 -15 -6 -18 -14z'/> <path d='M940 171 c0 -11 5 -23 12 -27 8 -5 9 0 6 14 -4 12 -2 22 3 22 5 0 9 -8 9 -17 0 -15 2 -16 10 -3 15 23 12 30 -15 30 -18 0 -25 -5 -25 -19z'/> <path d='M1100 181 c0 -5 6 -14 14 -20 10 -9 16 -8 26 4 7 9 10 19 6 22 -4 4 -11 1 -16 -7 -7 -10 -10 -11 -10 -2 0 6 -4 12 -10 12 -5 0 -10 -4 -10 -9z'/> <path d='M1160 170 c0 -11 4 -20 9 -20 6 0 9 9 8 20 -1 11 -5 20 -9 20 -4 0 -8 -9 -8 -20z'/> <path d='M1250 170 c-8 -16 -8 -20 4 -20 8 0 18 5 21 10 3 6 1 10 -5 10 -6 0 -8 5 -5 10 3 6 4 10 1 10 -3 0 -10 -9 -16 -20z'/> <path d='M1290 182 c0 -5 7 -15 15 -22 12 -10 16 -9 21 4 3 9 11 13 18 9 6 -3 5 0 -3 8 -11 11 -14 11 -18 1 -4 -10 -8 -10 -19 -1 -8 7 -14 7 -14 1z'/> <path d='M1410 171 c0 -11 4 -23 10 -26 6 -4 9 5 8 19 -3 30 -18 35 -18 7z'/> <path d='M1450 172 c0 -11 7 -18 20 -18 14 0 20 7 20 21 0 16 -2 17 -10 5 -6 -10 -10 -11 -10 -2 0 6 -4 12 -10 12 -5 0 -10 -8 -10 -18z'/> <path d='M1503 170 c-1 -11 4 -20 12 -20 8 0 11 7 8 20 -3 11 -8 20 -12 20 -4 0 -7 -9 -8 -20z'/> <path d='M1540 171 c0 -11 4 -22 9 -25 5 -3 8 5 7 19 -1 29 -16 34 -16 6z'/> <path d='M1571 174 c-1 -12 5 -21 14 -21 9 0 15 9 15 21 0 16 -2 18 -9 7 -7 -11 -9 -11 -14 0 -3 9 -6 6 -6 -7z'/> <path d='M1630 171 c0 -11 4 -22 9 -25 5 -3 8 5 7 19 -1 29 -16 34 -16 6z'/> <path d='M1661 174 c-1 -12 5 -21 14 -21 9 0 15 9 15 21 0 16 -2 18 -9 7 -7 -11 -9 -11 -14 0 -3 9 -6 6 -6 -7z'/> <path d='M1707 170 c-3 -13 0 -20 8 -20 8 0 13 9 12 20 -1 11 -4 20 -8 20 -4 0 -9 -9 -12 -20z'/> <path d='M1756 181 c-3 -4 1 -17 10 -27 14 -18 15 -18 9 4 -4 13 -2 22 4 22 6 0 11 -6 11 -14 0 -8 5 -18 12 -22 8 -5 9 0 6 14 -4 12 -2 22 3 22 5 0 9 -8 10 -17 0 -12 2 -13 6 -5 4 10 8 10 21 0 14 -12 14 -11 1 10 -10 16 -23 22 -51 22 -20 0 -39 -4 -42 -9z'/> <path d='M1890 180 c19 -4 29 -8 23 -9 -17 -1 -17 -18 0 -18 7 0 14 9 14 19 2 15 -5 18 -35 17 l-37 -2 35 -7z'/> <path d='M1988 169 c11 -29 27 -29 29 1 2 23 2 23 -6 5 -8 -17 -10 -18 -10 -2 -1 9 -5 17 -11 17 -5 0 -6 -9 -2 -21z'/> <path d='M2040 181 c10 -7 11 -11 3 -11 -7 0 -13 -4 -13 -8 0 -5 6 -9 14 -9 18 0 14 30 -5 35 -11 3 -11 1 1 -7z'/> <path d='M2070 170 c0 -11 5 -20 10 -20 6 0 10 9 10 20 0 11 -4 20 -10 20 -5 0 -10 -9 -10 -20z'/> <path d='M2107 170 c-3 -13 0 -20 9 -20 8 0 14 9 14 20 0 11 -4 20 -9 20 -5 0 -11 -9 -14 -20z'/> <path d='M2187 176 c-4 -10 -5 -21 -2 -24 9 -9 17 6 13 25 -3 17 -4 17 -11 -1z'/> <path d='M2220 168 c0 -19 2 -20 10 -8 13 19 13 30 0 30 -5 0 -10 -10 -10 -22z'/> <path d='M2258 171 c3 -9 1 -12 -6 -7 -7 4 -12 2 -12 -4 0 -7 6 -10 14 -7 7 3 18 1 24 -5 6 -6 12 -6 16 1 4 6 0 11 -10 11 -13 0 -15 3 -7 11 8 8 18 6 37 -6 25 -17 26 -17 26 3 0 18 -6 20 -44 19 -34 -1 -43 -4 -38 -16z'/> <path d='M2366 175 c18 -13 18 -14 1 -15 -10 0 -15 -5 -12 -10 5 -8 11 -7 21 1 11 9 11 15 3 25 -6 8 -16 14 -22 14 -6 0 -2 -7 9 -15z'/> <path d='M990 158 c0 -6 6 -8 14 -5 7 3 19 0 25 -6 8 -8 11 -8 11 1 0 7 -3 12 -7 13 -5 0 -16 2 -25 4 -10 2 -18 -1 -18 -7z'/> </g> </svg>"
                    + "</div>";


            helper.setFrom("doorstep@tgtv.tn");
            helper.setTo(toEmail);
            helper.setSubject(subject);
            helper.setText(htmlContent, true);
            
            mailSender.send(message);

        } catch (MessagingException e) {
            e.printStackTrace();
        }
    }

}
